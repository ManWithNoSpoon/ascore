(function(){var n,r,t,u,l,e,i,o,a,c,s,f,p,h,v,g,m,d,y,w,b,F,A,I,E,k,q,C,N,S,T,O,P,j,M,x,D,W,B,R,V,z,G,H,J,K,L,Q,U,X,Y,Z,$,nr,rr,tr,ur,lr,er,ir,or,ar,cr,sr,fr,pr,hr=[].slice,vr={}.hasOwnProperty,gr=function(n,r){function t(){this.constructor=n}for(var u in r)vr.call(r,u)&&(n[u]=r[u]);return t.prototype=r.prototype,n.prototype=new t,n.__super__=r.prototype,n};if(h=16,"undefined"!=typeof require)var _=require("underscore");else var _=window._;r="undefined"!=typeof exports?exports:window.A_={},nr=function(n,r){return function(t){return t(null,n.call(r||this))}},rr=function(n,r){return function(t,u){return u(null,n.call(r||this,t))}},tr=function(n,r){return function(t,u,l){return l(null,n.call(r||this,t,u))}},ur=function(n,r){return function(t,u,l,e){return e(null,n.call(r||this,t,u,l))}},lr=function(n,r){return function(t,u,l,e,i){return i(null,n.call(r||this,t,u,l,e))}},r.wrap0Arg=r.w0A=nr,r.wrap1Arg=r.w1A=rr,r.wrap2Arg=r.w2A=tr,r.wrap3Arg=r.w3A=ur,r.wrap4Arg=r.w4A=lr,r.wrapFun=er=function(n,r){return null==r&&(r=null),function(){var t,u,l;return t=2<=arguments.length?hr.call(arguments,0,l=arguments.length-1):(l=0,[]),(u=arguments[l++])(null,n.apply(r||this,t))}},r.wrapFunWithCatch=ir=function(n,r){return null==r&&(r=null),function(){var t,u,l,e,i,o;t=2<=arguments.length?hr.call(arguments,0,o=arguments.length-1):(o=0,[]),l=arguments[o++];try{i=n.apply(r||this,t)}catch(a){e=a,u=!0,l(e,null)}return u?void 0:l(null,i)}},r.each=A=function(n,r,u){if(_.isFunction(u))return _.isFunction(r)?_.isArray(n)||_.isObject(n)?_.isFunction(n)?n(function(n,l){return n?u(n):_.isArray(l)||_.isObject(l)?or(l,r,u):u(new t("Not a valid array or hash: "+l))}):or(n,r,u):u(new t("Not a valid array or hash: "+n)):u(new a("Item callback not a valid function: "+r));throw new l("Done callback not a valid function: "+u)},r.sloppyEach=Q=function(n,r,t){return _.isFunction(n)?n(function(n,u){return n?t(n):or(u,r,t)}):or(n,r,t)},or=function(n,r,t){var u,l;return l=_.isArray(n)?n.length:_.keys(n).length,l?(u=!1,_.each(n,function(n,e){return u?void 0:r(n,e,function(n){return n?(u=!0,t(n)):--l?void 0:t(null)})})):t(null)},x=function(n){return function(r,t){var u;if(null==t&&(t=null),u=[null,r],r=u[0],t=u[1],!_.isFunction(t))throw new a("Item callback not a valid function: "+t);return r?function(u){return n(r,t,u)}:function(r,u){return n(r,t,u)}}},r.eacher=E=x(A),r.sloppyEacher=U=x(Q),r.map=R=function(n,r,u,l){var e;if(null==l&&(l=null),null===l&&(e=[null,r,u],r=e[0],u=e[1],l=e[2]),_.isFunction(l))return _.isFunction(u)?_.isArray(n)||_.isObject(n)?_.isFunction(n)?n(function(n,e){return n?l(n,null):_.isArray(e)||_.isObject(e)?r&&_.isArray(e)?l(new p("No existing values may be provided when mapping an array"),null):cr(e,r,u,l):l(new t("Not a valid array or hash: "+e),null)}):r&&_.isArray(n)?l(new p("No existing values may be provided when mapping an array"),null):cr(n,r,u,l):l(new t("Not a valid array or hash: "+n),null):l(new a("Item callback not a valid function: "+u),null);throw new c("Callback for mapped values not a valid function: "+l)},r.sloppyMap=Z=function(n,r,t,u){var l;return null==u&&(u=null),null===u&&(l=[null,r,t],r=l[0],t=l[1],u=l[2]),_.isFunction(n)?n(function(n,l){return n?u(n,null):cr(l,r,t,u)}):cr(n,r,t,u)},cr=function(n,r,t,u){return r=_.isArray(n)?[]:r||{},or(n,function(n,u,l){return t(n,function(n,t){return n?l(n):(r[u]=t,l(null))})},function(n){return n?u(n,null):u(null,r)}),r},B=function(n){return function(r,t,u){var l,e;if(null==t&&(t=null),null==u&&(u=null),null===u&&(null===t?(l=[null,null,r],r=l[0],t=l[1],u=l[2]):(e=[r,null,t],r=e[0],t=e[1],u=e[2])),!_.isFunction(u))throw new a("Item callback not a valid function: "+u);return t?r?function(l){return n(r,t,u,l)}:function(r,l){return n(r,t,u,l)}:r?function(t,l){var e;return null==l&&(l=null),null===l&&(e=[null,t],t=e[0],l=e[1]),n(r,t,u,l)}:function(r,t,l){var e;return null==l&&(l=null),null===l&&(e=[null,t],t=e[0],l=e[1]),n(r,t,u,l)}}},r.mapper=z=B(R),r.sloppyMapper=$=B(Z),r.push=G=function(n,r,u,e){if(!_.isFunction(e))throw new l("Done callback not a valid function: "+e);return _.isFunction(u)?_.isFunction(r)?_.isArray(n)||e(new t("Not a valid array: "+n)):e(new a("Item callback not a valid function: "+r)):e(new s("Push-item-function not a valid function")),sr(n,r,u,e)},r.sloppyPush=sr=function(n,r,t,u){var l,e,i;return l=0,e=[],i=n.length,i||u(null),_.each(n,function(n,o){return r(n,function(n,r){var c;if(n)return void u(n);if(void 0===r)throw new a("Push item iterator should never give back undefined, use null instead");for(e[o-l]=r,c=[];void 0!==e[0];)++l,c.push(t(e.shift(),function(n){return n?u(n):--i?void 0:u(null)}));return c})})},r.eachPair=I=function(n,r,t){var u,l,e,i,o;if(u=!1,i=Math.ceil(n.length/2),!i)return void t(null,[]);for(e=[],l=0,o=[];l<n.length;)!function(l){var e,o;if(!u)return e=n[l],o=l+1<n.length?n[l+1]:void 0,r(e,o,l,function(n){return n?(u=!0,t(n)):--i?void 0:t(null)})}(l),o.push(l+=2);return o},r.mapPairs=V=function(n,r,t){var u;return u=[],I(n,function(n,t,l,e){return r(n,t,function(n,r){return u[l/2]=r,e(null)})},function(n){return n?t(n,null):t(null,u)})},r.reduce=H=function(n,r,l,e){var i;if(null==e&&(e=null),null===e&&(i=[void 0,r,l],r=i[0],l=i[1],e=i[2]),_.isFunction(e))return _.isFunction(l)?_.isArray(n)?fr(n,r,l,e):e(new t("Not a valid array: "+n),null):e(new u("Combine function not a valid function: "+l),null);throw new f("Callback for reduced value not a valid function: "+e)},fr=function(n,r,t,u,l){var e;return null==l&&(l=0),0===n.length?void u(null,r):(e=[],I(n,function(n,u,i,o){if(void 0===u){if(void 0===r)return e[i/2]=n,void o(null);u=r}return t(n,u,l,function(n,r){return n?o(n):(e[i/2]=r,o(null))})},function(n){return n?u(n,null):1===e.length?u(null,e[0]):fr(e,r,t,u,l+1)}))},r.reducer=J=function(n,r){return function(t,u){return H(t,n,r,u)}},r.filter=N=function(n,r,u){if(_.isFunction(u))return _.isFunction(r)?_.isArray(n)||_.isObject(n)?_.isFunction(n)?n(function(n,l){return n?u(n,null):_.isArray(l)||_.isObject(l)?ar(l,r,u):u(new t("Not a valid array or hash: "+l),null)}):ar(n,r,u):u(new t("Not a valid array or hash: "+n),null):u(new a("Item callback not a valid function: "+r),null);throw new i("Callback for filtered values not a valid function: "+u)},r.sloppyFilter=X=function(n,r,t){return _.isFunction(n)?n(function(n,u){return n?t(n,null):ar(u,r,t)}):ar(n,r,t)},ar=function(n,r,t){var u;return u=_.isArray(n)?[]:{},or(n,function(n,t,l){return void 0===n?l(new o("Array passed to A_.filter() should not contain undefined, use null instead")):r(n,function(r,e){return r?l(r):(e&&(u[t]=n),l(null))})},function(r){return r?t(r,null):(_.isArray(n)&&(u=_.filter(u,function(n){return void 0!==n})),t(null,u))}),u},D=function(n){return function(r){if(!_.isFunction(r))throw new a("Item callback not a valid function: "+r);return function(t,u){return n(t,r,u)}}},r.filterer=S=D(N),r.sloppyFilterer=Y=D(X),w=function(n,r){return _.isFunction(n)?n(r):r(null,n)},q=function(n,r){return _.isFunction(n)?n(r):r(new e("All items passed to fcollect/flob must be functions, got: "+n),null)},r.collect=y=z(w),r.fcollect=k=z(q),r.collector=b=function(n){return null==n&&(n={}),z(null,n,w)},r.fcollector=C=function(n){return null==n&&(n={}),z(null,n,q)},W=function(n){return function(r,t){return n(r,function(n,r){return t.call(r,n)})}},r.lob=j=W(y),r.flob=T=W(k),r.lobber=M=function(n){return null==n&&(n={}),W(b(n))},r.flobber=O=function(n){return null==n&&(n={}),W(C(n))},r.limit=P=function(n,r){var t,u,l,e,i,o,a;return null==r&&(r=null),null===r&&(a=[h,n],n=a[0],r=a[1]),e=0,l=[],u=[],i=function(r,i){return o(r,i),n>e?t(r,i):(l.push(r),u.push(i))},o=function(n,r){var i;return i=r.pop(),r.push(function(){var r;return r=1<=arguments.length?hr.call(arguments,0):[],e--,u.length&&t(l.shift(),u.shift()),i.apply(n,r)})},t=function(n,t){return e++,r.apply(n,t)},function(){var n;return n=1<=arguments.length?hr.call(arguments,0):[],i(this,n)}},r.sequence=r.seq=K=function(){var n,r,t;return r=2<=arguments.length?hr.call(arguments,0,t=arguments.length-1):(t=0,[]),n=arguments[t++],pr(r,n,[],{})},r.bindSequenceFun=r.bindSeqFun=g=function(n){return function(){var r,t,u;return t=2<=arguments.length?hr.call(arguments,0,u=arguments.length-1):(u=0,[]),r=arguments[u++],pr(t,r,[],n)}},r.bindSequence=v=function(){var n,r,t,u;return n=arguments[0],t=3<=arguments.length?hr.call(arguments,1,u=arguments.length-1):(u=1,[]),r=arguments[u++],pr(t,r,[],n)},r.sequencer=r.seqer=L=function(){var n;return n=1<=arguments.length?hr.call(arguments,0):[],function(){var r,t,u,l;return r=2<=arguments.length?hr.call(arguments,0,l=arguments.length-1):(l=0,[]),t=arguments[l++],u=n.slice(0),pr(u,t,r,{})}},r.bindSequencer=r.bindSeqer=m=function(){var n,r;return n=arguments[0],r=2<=arguments.length?hr.call(arguments,1):[],function(){var t,u,l,e;return t=2<=arguments.length?hr.call(arguments,0,e=arguments.length-1):(e=0,[]),u=arguments[e++],l=r.slice(0),pr(l,u,t,n)}},r.decorateWithSequencer=r.decSeqer=F=function(){var n;return n=1<=arguments.length?hr.call(arguments,0):[],function(){var r,t,u,l;return r=2<=arguments.length?hr.call(arguments,0,l=arguments.length-1):(l=0,[]),t=arguments[l++],u=n.slice(0),pr(u,t,r,this)}},pr=function(n,r,t,u){var l;return(l=n.shift())?l.apply(u,t.concat([function(){var t,l;return l=arguments[0],t=2<=arguments.length?hr.call(arguments,1):[],l?r.call(u,l):pr(n,r,t,u)}])):r.apply(u,[null].concat(t))},r.chainTriggersTo=d=function(n,r,t){var u,l,e;return null==r&&(r=null),null==t&&(t=null),null===t&&(null===r?(l=[!0,n],n=l[0],r=l[1]):_.isFunction(n)&&(e=[!0,n,r],n=e[0],r=e[1],t=e[2])),u=0,function(l,e,i){var o,a,c;return null==l&&(l=n),null==e&&(e=null),null==i&&(i=null),null===i&&_.isFunction(l)&&(c=[n,l,e],l=c[0],e=c[1],i=c[2]),u++,a=!1,e?(o=!1,function(){var n;return n=1<=arguments.length?hr.call(arguments,0):[],setTimeout(function(){var c;if(!a)return a=!0,l?(c=n.pop())&&r(c):n.push(function(n){return n?(o=!0,r(n)):void 0}),e.apply(i,n),o||--u?void 0:r.call(t,null)},0)}):function(n){return setTimeout(function(){return a?void 0:(a=!0,l&&n?r.call(t,n):--u?void 0:r.call(t,null))},0)}}},r.chainBindingsTo=function(n,r,t){var u,l,e,i,o,a,c;return null==r&&(r=null),null==t&&(t=null),null===r?(a=[!1,n],n=a[0],r=a[1]):null===t&&_.isFunction(n)&&(c=[!1,n,r],n=c[0],r=c[1],t=c[2]),e=0,u=[],l=0,o=0,i=function(n){return e++,r(n)},function(r,t,a){var c;return null==r&&(r=n),null==t&&(t=null),null==a&&(a=null),c=l++,u[c]=0,t?function(){var n;return n=1<=arguments.length?hr.call(arguments,0):[],setTimeout(function(){var l,s;if(t.apply(a,n),s=++u[c],s!==o){if(r){if(l=n.pop())return void i(l)}else n.push(function(n){return n?(o=s,i(n)):void 0});return e<Math.min.apply(null,u)?i(null):void 0}},0)}:function(n){return setTimeout(function(){var r;return r=++u[c],r!==o?n?(o=r,i(n)):e<Math.min.apply(null,u)?i(null):void 0:void 0},0)}}},r.Error=n=function(n){function r(n){this.message=n,Error.call(this,n),Error.captureStackTrace(this,arguments.callee)}return gr(r,n),r}(Error),r.InvalidDoneCbError=l=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return gr(r,n),r}(n),r.InvalidMapCbError=c=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return gr(r,n),r}(n),r.InvalidReduceCbError=f=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return gr(r,n),r}(n),r.InvalidFilterItemError=o=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return gr(r,n),r}(n),r.InvalidItemCbError=a=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return gr(r,n),r}(n),r.InvalidPushItemError=s=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return gr(r,n),r}(n),r.InvalidCombineFunError=u=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return gr(r,n),r}(n),r.InvalidArrError=t=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return gr(r,n),r}(n),r.InvalidValsError=p=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return gr(r,n),r}(n),r.InvalidFilterCbError=i=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return gr(r,n),r}(n),r.InvalidFCollectItem=e=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return gr(r,n),r}(n)}).call(this);